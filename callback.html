<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Authenticating...</title>
  <script>
    window.addEventListener("DOMContentLoaded", async () => {
      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get("code");

      if (!code) {
        document.body.innerHTML = "<h2>âŒ Missing authorization code.</h2>";
        return;
      }

      // CONFIG (×©× ×” ××ª ×”×¢×¨×›×™× ×©×œ×š ×›××Ÿ ×× ×¦×¨×™×š)
      const domain = "us-east-1ali2rxa83.auth.us-east-1.amazoncognito.com";
      const clientId = "4p73onv4dcvokvd85gv6fbtrr8";
      const redirectUri = "https://bonapetit-website.s3.us-east-1.amazonaws.com/callback.html";

      const tokenUrl = `https://${domain}/oauth2/token`;

      const body = new URLSearchParams({
        grant_type: "authorization_code",
        client_id: clientId,
        code,
        redirect_uri: redirectUri,
      });

      try {
        const response = await fetch(tokenUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body,
        });

        const data = await response.json();

        if (data.id_token) {
          // ×©××™×¨×” ×‘Ö¾sessionStorage
          sessionStorage.setItem("id_token", data.id_token);
          sessionStorage.setItem("access_token", data.access_token);
          sessionStorage.setItem("refresh_token", data.refresh_token);

          // ×”×¤× ×™×” ×œ-index.html
          window.location.href = "index.html";
        } else {
          console.error("âŒ Token fetch failed:", data);
          document.body.innerHTML = "<h2>âŒ Failed to retrieve tokens.</h2>";
        }
      } catch (error) {
        console.error("ğŸ”¥ Error fetching tokens:", error);
        document.body.innerHTML = "<h2>ğŸ”¥ Unexpected error occurred.</h2>";
      }
    });
  </script>
</head>
<body>
  <h2>ğŸ”„ Authenticating... Please wait</h2>
</body>
</html>
